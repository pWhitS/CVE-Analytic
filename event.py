import sys
import math

filename = sys.argv[1]
window = int(sys.argv[2])

with open(filename, 'r') as fin:
	eventList = fin.readlines()

for event in eventList:
	event = event.strip()
	name, date, os = event.split(',')
	month, day, year = date.split('-')
	break;

#ASLR test
fmonth = open("test-month.csv", 'r')
beforeList = []
afterList = []
isAfter = False

for line in fmonth:
	line = line.strip()

	eventDate = str(year) + "-" + str(month)
	cveDate = line.split(',')[0].split(':')[1]

	if eventDate == cveDate:
		isAfter = True

	if isAfter and len(afterList) < window + 1:
		afterList.append(line)
	elif not isAfter:
		if len(beforeList) < window:
			beforeList.append(line)
		else:
			beforeList = beforeList[1:]
			beforeList.append(line)

#convert lists of strings to lists of dictionaries
for i in range(len(beforeList)):
	beforeList[i] = dict(item.split(":") for item in beforeList[i].split(","))

for i in range(len(afterList)):
	afterList[i] = dict(item.split(":") for item in afterList[i].split(","))


vulnsList = []
for vulns in beforeList:
	vulnsList.append(vulns["bypassAttacks"])

for vulns in afterList:
	vulnsList.append(vulns["bypassAttacks"])

print vulnsList

def percentChange(v1, v2, growth):
	return (((int(v2) - int(v1)) / math.fabs(int(v1))) * 100)


i = 0
j = math.floor(len(vulnsList)/2)
totalChange = 0

while i < j:
	totalChange += percentChange(vulnsList[i], vulnsList[i+1], 0)
	i += 1

print totalChange, totalChange/j


i = int(math.floor(len(vulnsList)/2.0))
j = len(vulnsList)-1
totalChange = 0

while i < j:
	totalChange += percentChange(vulnsList[i], vulnsList[i+1], 0)
	i += 1

print totalChange, totalChange/j